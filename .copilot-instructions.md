# ai-governor Copilot Instructions

You are assisting development of ai-governor, a deterministic governance runtime.
This file contains strict rules for Copilot during v0.4 work.

## General Rules

1. **Do not change v0.3 behavior.**
   - v0.3 contract tests MUST pass unchanged.
   - Enforcement order and decisions must remain deterministic.

2. **Do not introduce new governance categories.**
   - No RBAC, no identity, no OPA/Rego integration.
   - No ML-based or probabilistic logic.

3. **All new code must be covered by tests.**
   - Tests must be written before implementation (test-first).
   - Tests must define behavior precisely.
   - If it cannot be tested deterministically, do not suggest it.

4. **Implement only what is explicitly defined by the schema.**
   - Only fields present in `policy-schema-v0.2.md` are allowed.
   - Reject attempts to add fields not specified in the schema.

5. **Do not infer defaults.**
   - Every value must be explicit.
   - Do not null/undef default behavior unless schema specifies.

6. **Enforcement semantics are strict.**
   - `deny` overrides `allow` always.
   - No implicit fallbacks or heuristics.
   - No deep merges unless defined.

7. **Error handling must be clear.**
   - All validation errors must enumerate the exact cause.
   - Do not return vague messages like “Invalid input.”

8. **If uncertain, ask instead of guessing.**
   - Copilot should generate questions/prompts instead of speculative code.

## v0.3 Invariants (Must Hold)

- Policy schema v0.1 remains supported and unchanged.
- CLI semantics (exit codes) cannot be modified for v0.3.
- All existing audit behavior (fail-fast, append-only) is fixed.
- Enforcement order is frozen.
- Any behavior covered by existing tests must not change.

## v0.4 Scope

- v0.2 schema support (tool arguments, model families, field-level PII rules).
- Tests must fail first; implementation follows.
- No new default policy behaviors.
- No implicit coercion or inference.

## Forbidden Prompts / Patterns

Do **not** generate code with prompts like:
- “Improve”, “Optimize”, “Enhance”
- “Make more flexible”
- “Handle all edge cases”
- “Add convenience logic”
- “Generalize for users”

If a prompt suggests these, refuse or ask for clarification.

## Safe Prompt Patterns

Good Copilot prompts (for high-confidence use):

> “Implement exactly as defined in `policy-schema-v0.2.md`.”

> “Write tests that validate the schema v0.2 behavior before implementation.”

> “Refactor for clarity but do not change public behavior.”

> “Generate a test that fails first for argument-level tool governance.”

## Goal

Produce code that:
- passes all existing contract tests,
- fails new tests initially,
- then passes new tests with minimal, spec-aligned changes,
- and maintains deterministic governance.

Constraints:
- v0.3 tests must pass unchanged.
- No implicit defaults.
- No deep merging.
- Minimal code only.
